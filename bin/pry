#!/usr/bin/env ruby
# frozen_string_literal: true

REPL = true

require_relative "../loader"

require "pry"

Sequel.extension :pg_json_ops

def dev_project
  return unless Config.development?
  ac = Account[email: "dev@ubicloud.com"] || Account.create_with_id(email: "dev@ubicloud.com")
  ac.projects.first || ac.create_project_with_default_policy("default")
end

def udec(*)
  UBID.decode(*)
end

def udec_deleted(ubid)
  DeletedRecord.where(Sequel.pg_json(:model_values)["name"] => Sequel.pg_jsonb_wrap(UBID.parse(ubid).to_uuid)).first
end

opts = Pry::CLI.parse_options
Pry.config.prompt_name = if Config.production?
  "\e[41m⚠️ %s\e[0m" % "clover-#{Config.rack_env}"
else
  "clover-#{Config.rack_env}"
end

Pry::CLI.start(opts)
